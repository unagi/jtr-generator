# jtr-generator - 詳細仕様

このドキュメントは、jtr-generatorプロジェクトの詳細な技術仕様をまとめたものです。

**実装時の必須確認事項**: [AGENTS.md](../AGENTS.md)を必ず参照してください（コード品質要件、CI/CD準拠など）。

## アーキテクチャ

### ビルドプロセス

各プラットフォームのパッケージ（例: `build/claude.zip`）は以下を含む:
1. `src/` の共通実装
2. `schemas/` のスキーマ定義
3. `platforms/{platform}/` の固有ファイル
4. ユーザーが配置した `fonts/`（オプション）

### プラットフォーム別の責務

| コンポーネント | 説明 | 共通 | Claude | Gemini | ChatGPT |
|---------------|------|------|--------|--------|---------|
| src/* | 実装ロジック | ✅ | - | - | - |
| schemas/* | データ定義 | ✅ | - | - | - |
| skill.json | メタデータ | - | ✅ | ✅ | ✅ |
| main.py | エントリーポイント | - | ✅ | ✅ | ✅ |
| config.yaml | 設定テンプレート | - | ✅ | ✅ | ✅ |

### モジュール分割方針

**src/models/** - データモデル定義
- Python dataclassesまたはPydanticを使用
- 型安全性を重視
- JSON Schemaとの整合性を保つ

**src/generators/** - PDF生成ロジック
- ReportLabを使用した高品質PDF生成
- JIS規格準拠のレイアウト実装
- フォント設定は外部から注入

**src/validators/** - バリデーション
- JSON Schema突合
- 必須項目チェック
- フォーマット検証

**src/formatters/** - ユーティリティ
- 和暦変換（西暦 ↔ 令和/平成/昭和）
- 正式名称変換
- 日付フォーマット

### 設定ファイル（config.yaml）

プラットフォーム固有ディレクトリ（例: `platforms/claude/config.yaml`）に配置:

```yaml
options:
  date_format: seireki    # 'seireki' or 'wareki'
  paper_size: A4          # 'A4' or 'B5'

fonts:
  main: fonts/main.ttf           # 本文用フォント（相対パス）
  heading: fonts/heading.ttf     # 見出し用フォント（相対パス、optional）
```

**注意**: フォントパスは相対パスで記述し、各プラットフォームの実装（main.py）で絶対パスに解決します。

## ドメイン知識：日本の履歴書仕様

### 用紙・レイアウト規格

- **用紙サイズ**: A4（297mm × 210mm）またはB5（257mm × 182mm）
- **印刷**: 片面印刷、縦方向
- **余白**: 上下左右それぞれ10-15mm程度
- **フォント**: 明朝体が基本、見出しはゴシック体も可

### 必須記載項目

#### 1. 基本情報
- 氏名（ふりがな付き）
- 生年月日（和暦/西暦）
- 年齢
- 性別
- 証明写真（縦40mm × 横30mm、3ヶ月以内撮影）

#### 2. 連絡先情報
- 現住所（都道府県から番地まで）
- 郵便番号
- 電話番号（固定電話/携帯電話）
- メールアドレス

#### 3. 学歴
- 時系列順（古い順）
- 小学校卒業から記載が一般的
- 「〇〇高等学校 卒業」のように正式名称
- 和暦または西暦（統一）

#### 4. 職歴
- 時系列順（古い順）
- 会社名は正式名称（株式会社の位置に注意）
- 入社・退職の理由（「一身上の都合により退職」等）
- 現職の場合は「現在に至る」

#### 5. 資格・免許
- 取得年月順
- 正式名称（「普通自動車第一種運転免許」等）

#### 6. 志望動機・自己PR
- 200-300文字程度
- 企業ごとにカスタマイズ可能

### 書式ルール

#### 年号表記
- 和暦（令和、平成、昭和）または西暦
- ドキュメント内で統一すること
- 西暦の場合は4桁表記

#### 敬称・表記
- 学校名：「〇〇高等学校」（「高校」と略さない）
- 会社名：「株式会社〇〇」「〇〇株式会社」（正式名称）
- 学部・学科：正式名称（「工学部 情報工学科」等）
- 卒業/修了：「卒業」「修了」を正確に使い分け

#### 禁止事項
- 略語の使用（「㈱」「高」等）
- 誤字・脱字
- 修正液の使用（印刷後の修正不可）

## データモデル設計

### 概要

履歴書データは以下の5つのセクションで構成されます:

```yaml
personal_info:      # 個人情報（氏名、生年月日、連絡先等）
education:          # 学歴（配列）
work_history:       # 職歴（配列）
qualifications:     # 資格・免許（配列）
additional_info:    # 志望動機・自己PR
```

### 詳細仕様

データモデルの詳細は **JSON Schema** で定義されています:
- **スキーマファイル**: [schemas/resume_schema.json](../schemas/resume_schema.json)
- **サンプルデータ**: [examples/sample_resume.yaml](../examples/sample_resume.yaml) および [examples/sample_resume.json](../examples/sample_resume.json)

### データ形式要件

- **入力形式**: YAML または JSON
- **バリデーション**: YAMLは処理前にJSON化され、JSON Schemaと突合
- **マルチライン**: YAMLは `|` 記法で改行を保持、JSONは `\n` エスケープ
- **日付形式**: ISO 8601形式（`YYYY-MM-DD` または `YYYY-MM`）
- **必須フィールド**: スキーマの `required` プロパティで定義
- **列挙型**: 性別、学歴・職歴の種別等はスキーマで定義された値のみ許可

## 出力フォーマット要件

### PDF形式（.pdf）

- **ページサイズ**: A4/B5
- **フォント埋め込み**: 必須（印刷互換性のため）
- **解像度**: 300dpi以上推奨
- **証明写真エリア**: 縦40mm × 横30mm（画像は手動配置）
- **罫線**: すべての項目に適切な罫線
- **余白**: 上下左右10-15mm

## 制限事項

### 現在の制限

- **証明写真**: 画像パスの指定のみ対応、自動埋め込みは未対応
- **職歴件数**: 転職回数が10回を超える場合、レイアウトが崩れる可能性
- **カスタムレイアウト**: 標準的なJIS規格フォーマットのみ対応

### 技術的制約

- **フォント**: ライセンス上の理由により非同梱、ユーザー提供必須
- **生成時間**: LLM Skills APIの仕様により1-2分程度かかる
- **ファイルサイズ**: 生成PDFは通常1MB以下

## 将来の拡張性

### 想定される追加機能

- 職務経歴書生成
- 英文レジュメ対応
- 複数テンプレート（業種別、デザイン別）
- 証明写真の自動埋め込み
- オンラインプレビュー機能

### 他のLLM対応

プロジェクトアーキテクチャはLLM非依存で設計。
将来的にGemini、OpenAI等の同様のドキュメント生成機能への対応が可能。

各LLMプラットフォーム固有の実装詳細は、以下のドキュメントに分離:
- [CLAUDE.md](../CLAUDE.md) - Claude Skills API仕様
- `GEMINI.md` - Gemini Skills相当機能（未作成）
- `OPENAI.md` - OpenAI Skills相当機能（未作成）

## 参考情報

### JIS規格
- JIS Z 8303（帳票の設計基準）
- 一般的な履歴書フォーマットはJIS規格に準拠

### データソース
- ハローワーク推奨履歴書フォーマット
- 厚生労働省履歴書様式例

### 日本語フォント
- IPAフォント: https://moji.or.jp/ipafont/
- Noto Sans JP: https://fonts.google.com/noto/specimen/Noto+Sans+JP
- 源ノ角ゴシック: https://github.com/adobe-fonts/source-han-sans
- BIZ UDゴシック/明朝: https://github.com/googlefonts/morisawa-biz-ud-gothic
