# jtr-generator - 検証・テスト方針

このドキュメントは、jtr-generatorプロジェクトの検証・テスト方針をまとめたものです。

**実装時の必須確認事項**: [AGENTS.md](../AGENTS.md)を必ず参照してください（コード品質要件、CI/CD準拠など）。

## フォーマット検証

- [ ] すべての必須項目が記載されているか
- [ ] 年号表記が統一されているか（和暦/西暦混在なし）
- [ ] 正式名称が使用されているか（略語なし）
- [ ] 時系列が正しいか（古い順）

## レイアウト検証

- [ ] 証明写真エリアのサイズが正しいか
- [ ] 各項目の配置が適切か
- [ ] 罫線が欠けていないか
- [ ] フォントサイズが読みやすいか
- [ ] 長いテキストが適切に改行・配置されるか

## 印刷検証

- [ ] A4用紙に正しく印刷されるか（B5は将来対応予定）
- [ ] 余白が適切か
- [ ] 文字が切れていないか
- [ ] 実機での印刷テスト

## データ整合性検証

- [ ] 生年月日から年齢が正しく計算されているか
- [ ] 学歴・職歴の時系列に矛盾がないか
- [ ] 資格取得年月が生年月日より後か
- [ ] JSON Schemaに準拠しているか

## 自動テスト

### ユニットテスト

各モジュールに対するユニットテスト:

- `skill/scripts/jtr/` - PDF生成、データ読み込み、日付変換、レイアウト関連
- `tools/` - レイアウト検証ツール

### 統合テスト

エンドツーエンドのテスト:

- YAML/JSONファイルからのPDF生成
- 各種オプション（和暦/西暦、A4のみ、B5は将来対応予定）の動作確認
- エラーハンドリング

### テスト実行

```bash
# すべてのテストを実行（CIと同等のカバレッジ付き）
uv run poe test-cov

# すばやく実行（カバレッジなし、開発時用）
uv run poe test
```

### カバレッジ要件

- **最低カバレッジ**: 80%以上必須（CI/CDで強制）
- **新規コード**: 実装と同時にテストを追加
- **エッジケース**: 正常系だけでなく異常系もカバー

### カバレッジレポートの確認方法

```bash
# カバレッジレポート生成（推奨: CIと完全一致）
uv run poe test-cov

# 手動で詳細確認する場合（CIと同等）
uv run pytest tests/ --cov=skill --cov=tools --cov-report=term-missing --cov-report=xml --spec
```

### カバレッジが低い場合の対処

1. レポートでカバレッジが低いファイル・関数を特定
2. そのコードに対応するテストを追加
3. 再度カバレッジを確認して80%以上であることを確認

品質ゲート全体については[AGENTS.md - コード品質要件](../AGENTS.md#code-quality)を参照してください。
